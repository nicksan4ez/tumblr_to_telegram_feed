# Tumblr RSS → Telegram

Скрипт публикует изображения из Tumblr RSS-лент в канал / чат Telegram.  
Проект подготовлен для развёртывания на любом хостинге или через Docker, а все чувствительные настройки вынесены во внешний конфиг.

**Скрипт завершается как пройдется по всем файлам**

## Структура проекта

- `script_tumblr.py` — основной скрипт.
- `config.example.ini` — пример конфигурации, который нужно скопировать в `config.ini` и заполнить.
- `data/rss_feeds.sample.txt` — пример файла с RSS-лентами, одна ссылка на строку.
- `requirements.txt` — зависимости Python.
- `Dockerfile`, `docker-compose.yml` — файлы для контейнеризации.
- `.gitignore`, `.dockerignore` — списки исключений, чтобы токены, лог-файлы и рабочие данные не попали в репозиторий.

## Быстрый старт без Docker

1. Установите Python 3.11+.
2. Создайте и активируйте виртуальное окружение (необязательно, но рекомендуется).
3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

4. Подготовьте конфигурацию:

   ```bash
   copy config.example.ini config.ini  # Windows
   cp config.example.ini config.ini    # Linux / macOS
   ```

   Заполните файл `config.ini` значениями вашего бота, чата и путей к файлам.

5. Создайте файл `data/rss_feeds.txt` и укажите в нём RSS-ленту на Tumblr (по одной ссылке на строку).

6. Запустите скрипт:

   ```bash
   python script_tumblr.py --config config.ini
   ```
## Запуск в Docker

1. Скопируйте `config.example.ini` в `config.ini`, заполните персональные данные.
2. Убедитесь, что каталоги `data/` и `logs/` существуют (они будут смонтированы в контейнер).  
   При необходимости создайте их: `mkdir data logs`.
3. Заполните `data/rss_feeds.txt` вашими RSS-лентами.
4. Соберите и запустите контейнер:

   ```bash
   docker compose up --build -d
   ```

   Конфигурация и рабочие файлы монтируются как тома, поэтому токены остаются только на вашей машине.

## Запуск по расписанию (crontab)

Для запуска скрипта на сервере автоматически и по рассписанию удобнее использовать `crontab`.
Ниже пример разового запуска каждые 30 минут, с логированием в `logs/script_tumblr.log`:

Открываем:
```bash
crontab -e
```
Добавляем:
```cron
*/30 * * * * /usr/bin/python3 /path/to/sript/script_tumblr.py --config /path/to/sript/config.ini >> /path/to/sript/logs/cron.log 2>&1
```

Рекомендации:
- Замените пути в примере на ваши серверные директории.
- Указывайте абсолютные пути к `python`, скрипту и `config.ini`.
- Если используете venv, замените `/usr/bin/python3` на путь к интерпретатору внутри окружения.
- Для разового запуска "когда нужно" можно временно добавить строку в `crontab`, выполнить `crontab -e`, затем удалить запись. Как настроить время - лучше всего поможет https://crontab.guru

## Формат конфигурации

```ini
[telegram]
bot_token = Токен бота
chat_id = ID канала или чата
media_caption = HTML-подпись к медиа (опционально)

[storage]
rss_feeds_file = путь до файла с RSS-лентами
published_images_file = путь до файла, в который сохраняются уже опубликованные ссылки

[script]
delay_between_posts = задержка между отправками (в секундах)
log_file = путь до лог-файла
```

Относительные пути интерпретируются относительно расположения `config.ini`.


## Полезные команды

- Обновить зависимости: `pip install -U -r requirements.txt`
- Остановить контейнер: `docker compose down`
- Просмотреть логи контейнера: `docker compose logs -f`

## Лицензия

MIT
